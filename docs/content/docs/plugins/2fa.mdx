---
title: Two Factor
description: Two Factor
---

Two factor authentication is a security feature that adds an extra layer of security to your account. It requires users to provide a second form of verification, in addition to their password, before they can log in to your account.

The two facor plugin providers `OTP` and `TOTP` authentication methods. The `OTP` method is a one-time password that is sent to the user's email or phone number, while the `TOTP` method is a time-based one-time password that is generated by the user's device.


## Quick setup

<Steps>
    <Step>
        ### Add the plugin to your auth config
        To add the two factor plugin to your auth config, you need to import the plugin and pass it to the `plugins` option of the auth instance.

        ```ts title="auth.ts" twoslash
        import { betterAuth } from "better-auth"
        import { twoFactor } from "better-auth/plugins"
        
        export const auth = await betterAuth({
            database: {
                provider: "sqlite",
                url: "./db.sqlite",
            },
            plugins: [ // [!code highlight]
                twoFactor({ // [!code highlight]
                    issuer: "my-app" // [!code highlight] 
                }) // [!code highlight]
            ] // [!code highlight]
        })
        ```
    </Step>

    <Step>
        ### Migarate database
        Once you've added the plugin, you need to migrate your database to add the necessary tables and fields. You can do this by running the following command:

        ```bash
        npx better-auth migrate
        ```
    </Step>

    <Step>
    ### Add the client plugin
    To use the two factor plugin in the client, you need to add it on your plugins list.

    ```ts title="client.ts" twoslash
    import { createAuthClient } from "better-auth/client"
    import { twoFactorClient } from "better-auth/client/plugins"
    
    const client = createAuthClient({
        plugins: [ // [!code highlight]
            twoFactorClient({ // [!code highlight]
                twoFactorPage: "/two-factor" // [!code highlight] 
            }) // [!code highlight]
        ] // [!code highlight]
    })
    ```
    </Step>
    <Step>
        ### Enable two factor authentication for a user

        To enable two factor authentication for a user, you can use the `twoFactor.enable` function provided by the client. Make sure the user is signed in before calling this function.

        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ]
        })
        // ---cut---
        const enableTwoFactor = async() => {
            const data = await client.twoFactor.enable() // this will enable two factor authentication for the signed in user
        }
        ```
        <Callout type="info">
            You can also disable two factor authentication for a user by calling the `twoFactor.disable` function.
        </Callout>
    </Step>
    <Step>
        ### Get the TOTP URI
        once you've enabled two factor authentication, you can get the TOTP URI by calling the `twoFactor.getTotpUri` function. This function returns an object with the `totpURI` property, which is the URI that the user needs to scan with their TOTP app.

        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ]
        })
        // ---cut---
        const { data, error } = await client.twoFactor.getTotpUri()
        ```
        <Callout type="info">
        You can either generate a QR code with this URI for the user to scan or simply display the URI on the screen.
        </Callout>
    </Step>
    <Step>
        ### Generate backup codes
        To generate backup codes, you can use the `generateBackupCodes` function provided by the client.

        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ]
        })
        // ---cut---
        const { data, error } = await client.twoFactor.generateBackupCodes()
        ```
        <Callout type="info">
            Make sure to show the backup codes to the user. So they can store them in a safe place.
        </Callout>
    </Step>
    <Step>
        ### Sign In with 2-Factor

        Once the user has enabled 2-Factor, when they try to sign in, a session won't be created before they passed the 2-Factor verification. If you didn't disable redirects, the user will be redirected to the two factor page you porvided on the client plugin. If you disbaled redirects, you need to handler callbacks.

    
        **Callbacks**

        Since better auth client wraps over [bette-fetch](https://better-fetch.vercel.app), you can use the `onSuccess` callback to handle the callback from the provider.
        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ] // [!code highlight]
        })
        // ---cut---
        const signin = async () => {
            const data = await client.signIn.email({
                email: "test@example.com",
                password: "password1234",
                options: {
                    async onSuccess(context){
                        if(context.data.twoFactorRedirect){
                            // handler the callback
                        }
                    }
                }
            })
        }
        ```
        
        **Send 2-Factor OTP**

        If you want to use OTP over SMS or Email, you can use the `twoFactor.sendOtp` function provided by the client.
        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ] // [!code highlight]
        })
        // ---cut---
        /**
         * This will call the sendOTP function you added 
         * on the server.
         */
        const data = await client.twoFactor.sendOtp()
        ```

        **Verify 2-Factor**

        once you presented the user with an input field to enter the OTP, you can use the `twoFactor.verifyOtp` or `twoFactor.verifyTOTP` function provided by the client.
        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ] // [!code highlight]
        }) 
        // ---cut---
        await client.twoFactor.verifyOtp({
                code: "123456",
        })
        //or
        await client.twoFactor.verifyTotp({
                code: "123456",
                callbackURL: "/"
        })
        ```

        **Using Backup Code to verify 2-Factor**

        If you want to use backup codes to verify 2-Factor, you can use the `twoFactor.verifyBackupCode` function provided by the client.
        ```ts title="client.ts" twoslash
        import { createAuthClient } from "better-auth/client"
        import { twoFactorClient } from "better-auth/client/plugins"
        const client = createAuthClient({
            plugins: [ // [!code highlight]
                twoFactorClient({ // [!code highlight]
                    twoFactorPage: "/two-factor" // [!code highlight] 
                }) // [!code highlight]
            ] // [!code hi  ghlight]
        })
        // ---cut---
        await client.twoFactor.verifyBackupCode({
                code: "123456",
        })
        ```
    </Step>
    <Step>
        ðŸŽ‰ the user has successfully signed in with 2-Factor!
    </Step>
</Steps>


## Configuration

### Server

To configure the two factor plugin, you need to add the following code to your better auth instance.

```ts title="auth.ts" twoslash
import { betterAuth } from "better-auth"
import { twoFactor } from "better-auth/plugins"

export const auth = await betterAuth({
    database: {
        provider: "sqlite",
        url: "./db.sqlite",
    },
    plugins: [ // [!code highlight]
        twoFactor({ // [!code highlight]
            issuer: "my-app" // [!code highlight] 
        }) // [!code highlight]
    ] // [!code highlight]
})
```

**Issuer**: The issuer is the name of your application. It's used to generate totp codes. It'll be displayed in the authenticator apps.

**TOTP options**

these are options for TOTP. 

<TypeTable
  type={{
    digits:{
        description: 'The number of digits the otp to be',
        type: 'number',
        default: 6,
    },
    period: {
        description: 'The period for otp in seconds.',
        type: 'number',
        default: 30,
    },
  }}
/>

**OTP options**

these are options for OTP.

<TypeTable
  type={{
    sendOTP: {
        description: "a function that sends the otp to the user's email or phone number. It takes two parameters: user and otp",
        type: "function",
    },
    period: {
        description: 'The period for otp in seconds.',
        type: 'number',
        default: 30,
    },
  }}
  />

**Backup Code Options**

backup codes are generated and stored in the database when the user enabled two factor authentication. This can be used to recover access to the account if the user loses access to their phone or email.

<TypeTable
    type={{
        amount: {
            description: "The amount of backup codes to generate",
            type: "number",
            default: 10,
        },
        length: {
            description: "The length of the backup codes",
            type: "number",
            default: 10,
        },
        customBackupCodesGenerate: {
            description: "A function that generates custom backup codes. It takes no parameters and returns an array of strings.",
            type: "function",
        },
    }}
/>

### Client 

To use the two factor plugin in the client, you need to add it on your plugins list.

```ts title="client.ts" twoslash
import { createAuthClient } from "better-auth/client"
import { twoFactorClient } from "better-auth/client/plugins"

const client = createAuthClient({
    plugins: [
        twoFactorClient({ // [!code highlight]
            twoFactorPage: "/two-factor" // [!code highlight] 
        }) // [!code highlight]
    ] // [!code highlight]
})
```

**Options**

`twoFactorPage`: The page to redirect the user to after they have enabled 2-Factor. This is the page where the user will be redirected to verify their 2-Factor code.

`redirect`: If set to `false`, the user will not be redirected to the `twoFactorPage` after they have enabled 2-Factor.


## Database Schema

Two factores requires additional fields on the user table. If you use better auth's migration system, it will automatically create this table for you.

```ts
const schema = {
    user: {
        fields: {
            twoFactorEnabled: {
                type: "boolean",
                required: false,
                defaultValue: false,
            },
            twoFactorSecret: {
                type: "string",
                required: false,
            },
            twoFactorBackupCodes: {
                type: "string",
                required: false,
                returned: false,
            },
        },
    },
}
```